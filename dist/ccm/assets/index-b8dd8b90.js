var v=(o,p,f)=>new Promise((x,k)=>{var q=u=>{try{g(f.next(u))}catch(b){k(b)}},C=u=>{try{g(f.throw(u))}catch(b){k(b)}},g=u=>u.done?x(u.value):Promise.resolve(u.value).then(q,C);g((f=f.apply(o,p)).next())});import{_ as pe}from"./CommonPage-06556ed1.js";import{_ as fe}from"./CrudDrawer-cc93fcce.js";import{_ as ve}from"./CrudTable-aa655061.js";import{_ as ye}from"./TheIcon-e8a5b0d0.js";import{s as d,q as m,C as he,o as Q,j,w as s,n as G,k as n,l as a,_ as R,m as H,D as S,F as _e,h as U}from"./index-fcd7eebc.js";import{u as K,_ as ge,a as be}from"./useCRUD-c139838b.js";import{r as z}from"./icon-7bfbf4ba.js";import{_ as Re}from"./Tree-f1162475.js";import{_ as ke}from"./Input-cea9b87e.js";import"./AppPage-7316f500.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./use-merged-state-3264fb8d.js";import"./Space-7ee4e193.js";import"./Checkbox-933958cf.js";import"./Popover-f5e6c032.js";import"./get-eaa4dfe4.js";import"./use-compitable-3d6c947e.js";import"./Suffix-8eaa0c4a.js";import"./Dropdown-ca79176c.js";import"./create-d1a5db2f.js";import"./Tooltip-1bd68290.js";import"./Empty-0b13ab0a.js";import"./use-locale-ea43045e.js";import"./Select-40890403.js";import"./Tag-51d84e9a.js";import"./Eye-1bd242ac.js";const r={listRole:()=>d.post("/role/listRole"),addRole:(o={})=>d.post("/role/addRole",o),updateRole:(o={})=>d.post("/role/updateRole",o),deleteRole:(o={})=>d.post("/role/deleteRole",o),listMenu:()=>d.post("/menu/listMenu"),listCategory:()=>d.post("/category/listCategory"),listRoleMenu:(o={})=>d.post("/roleMenu/listRoleMenu",o),updateRoleMenu:(o={})=>d.post("/roleMenu/updateRoleMenu",o),listRoleCategory:(o={})=>d.post("/roleCategory/listRoleCategory",o),updateRoleCategory:(o={})=>d.post("/roleCategory/updateRoleCategory",o)},Ce=G("div",null,null,-1),Xe={__name:"index",setup(o){const p=m(null);he(()=>{p.value.handleSearch(),u(),X()});const f=m([]),x=m(1);function k(e=1){x.value=e,e===1?f.value=C.value:f.value=N.value}function q(){return v(this,null,function*(){x.value===1?yield W():yield Z()})}const C=m([]),g=m(!1);function u(){return v(this,null,function*(){g.value=!0,C.value=[];const e=yield r.listMenu(),l=b(e.data);C.value=l,g.value=!1})}function b(e=[]){const l=[];return e.forEach(t=>{const _={label:t.menuName+" / "+t.permission,key:t.id,children:[]};t.children&&t.children.length&&(_.children=b(t.children)),l.push(_)}),l}const c=m([]);function J(e){return v(this,null,function*(){c.value=[];const l=yield r.listRoleMenu({id:e});l==null||l.data.forEach(t=>{c.value.push(t.menuId)})})}function W(){return v(this,null,function*(){var e;if(I.value.menuIds=c.value,!["edit","add"].includes(T.value)){h.value=!1;return}try{D.value=!0;const l=yield r.updateRoleMenu(I.value);$message.success("编辑成功"),D.value=h.value=!1,l&&((e=p.value)==null||e.handleSearch())}catch(l){E.value=!1}})}const N=m([]);function X(){return v(this,null,function*(){N.value=[];const e=yield r.listCategory(),l=B(e.data);N.value=l})}function B(e=[]){const l=[];return e.forEach(t=>{const _={label:t.name,key:t.id,children:[]};t.children&&t.children.length&&(_.children=B(t.children)),l.push(_)}),l}function Y(e){return v(this,null,function*(){c.value=[];const l=yield r.listRoleCategory({id:e});l==null||l.data.forEach(t=>{c.value.push(t.categoryId)})})}function Z(){return v(this,null,function*(){var e;if(I.value.categoryIds=c.value,!["edit","add"].includes(T.value)){h.value=!1;return}try{D.value=!0;const l=yield r.updateRoleCategory(I.value);$message.success("编辑成功"),D.value=h.value=!1,l&&((e=p.value)==null||e.handleSearch())}catch(l){E.value=!1}})}const w=m({});function ee(){for(const e in w.value)w.value[e]=null}const M=m([]);function le(e){e.length?M.value=[...e]:M.value=[]}function ae(){M.value.length?(O({ids:M.value}),M.value=[]):$message.error("未选中任何数据")}const te=[{type:"selection",fixed:"left"},{title:"角色名称",key:"roleName",width:240},{title:"角色编码",key:"code",width:240},{title:"操作",key:"actions",width:280,align:"center",fixed:"right",hideInExcel:!0,render(e){return[U(R,{size:"small",type:"primary",onClick:()=>{ie(e,!1)}},{default:()=>"编辑",icon:z("material-symbols:edit-outline",{size:14})}),U(R,{size:"small",type:"primary",style:"margin-left: 15px;",onClick:()=>{k(1),J(e.id),L({roleId:e.id},!1)}},{default:()=>"角色权限",icon:z("ic:baseline-vpn-key",{size:14})}),U(R,{size:"small",type:"primary",style:"margin-left: 15px;",onClick:()=>{k(2),Y(e.id),L({roleId:e.id},!1)}},{default:()=>"角色菜单",icon:z("ic:baseline-vpn-key",{size:14})}),U(R,{size:"small",type:"error",style:"margin-left: 15px;",onClick:()=>{O({ids:[e.id]})}},{default:()=>"删除",icon:z("material-symbols:delete-outline",{size:14})})]}}],{modalVisible:$,modalTitle:oe,modalLoading:E,modalAction:F,handleAdd:ne,handleDelete:O,handleEdit:ie,handleSave:se,modalForm:y,modalFormRef:re}=K({name:"角色",initForm:{},doCreate:r.addRole,doDelete:r.deleteRole,doUpdate:r.updateRole,doSearch:null,refresh:()=>{var e;return(e=p.value)==null?void 0:e.handleSearch()}}),{modalVisible:h,modalTitle:de,modalLoading:D,modalAction:T,handleEdit:L,modalForm:I}=K({name:"角色权限",initForm:{},doCreate:null,doDelete:null,doUpdate:r.updateRoleMenu,doSearch:null,refresh:()=>{var e;return(e=p.value)==null?void 0:e.handleSearch()}});return(e,l)=>{const t=ye,_=ve,V=ke,A=ge,ue=be,P=fe,ce=Re,me=pe;return Q(),j(me,{"show-footer":"",title:"角色管理"},{action:s(()=>[G("div",null,[n(a(R),{type:"primary",onClick:a(ne)},{default:s(()=>[n(t,{icon:"material-symbols:add",size:18,class:"mr-5"}),H(" 新建角色 ")]),_:1},8,["onClick"]),n(a(R),{type:"error",class:"ml-16",onClick:ae},{default:s(()=>[n(t,{icon:"material-symbols:delete-outline",size:18,class:"mr-5"}),H(" 批量删除 ")]),_:1})])]),default:s(()=>[n(_,{ref_key:"$table",ref:p,"query-items":a(w),"onUpdate:queryItems":l[0]||(l[0]=i=>S(w)?w.value=i:null),"row-key":"id","scroll-x":1200,columns:te,"is-pagination":!1,"get-data":a(r).listRole,onOnChecked:le,onResetQueryItems:ee},{queryBar:s(()=>[Ce]),_:1},8,["query-items","get-data"]),n(P,{visible:a($),"onUpdate:visible":l[4]||(l[4]=i=>S($)?$.value=i:null),title:a(oe),loading:a(E),"show-footer":a(F)!=="view",onOnSave:a(se)},{default:s(()=>[n(ue,{ref_key:"modalFormRef",ref:re,model:a(y),"label-placement":"left","label-align":"left","label-width":80,disabled:a(F)==="view"},{default:s(()=>[n(A,{labe:"角色id",path:"id"},{default:s(()=>[n(V,{value:a(y).id,"onUpdate:value":l[1]||(l[1]=i=>a(y).id=i),disabled:""},null,8,["value"])]),_:1}),n(A,{label:"角色名称",path:"roleName",rule:{required:!0,message:"请输入角色名称",trigger:"blur"}},{default:s(()=>[n(V,{value:a(y).roleName,"onUpdate:value":l[2]||(l[2]=i=>a(y).roleName=i),maxlength:"15",placeholder:"请输入角色名称"},null,8,["value"])]),_:1}),a(F)==="add"?(Q(),j(A,{key:0,label:"角色编码",path:"code",rule:{required:!0,message:"请输入角色编码",trigger:"blur"}},{default:s(()=>[n(V,{value:a(y).code,"onUpdate:value":l[3]||(l[3]=i=>a(y).code=i),maxlength:"10",placeholder:"请输入角色编码"},null,8,["value"])]),_:1})):_e("",!0)]),_:1},8,["model","disabled"])]),_:1},8,["visible","title","loading","show-footer","onOnSave"]),n(P,{visible:a(h),"onUpdate:visible":l[6]||(l[6]=i=>S(h)?h.value=i:null),title:a(de),loading:a(D),"show-footer":a(T)!=="view",onOnSave:q},{default:s(()=>[n(ce,{"checked-keys":a(c),"onUpdate:checkedKeys":l[5]||(l[5]=i=>S(c)?c.value=i:null),data:a(f),checkable:"",selectable:"","block-line":"","default-expand-all":""},null,8,["checked-keys","data"])]),_:1},8,["visible","title","loading","show-footer"])]),_:1})}}};export{Xe as default};
