var T=(r,U,c)=>new Promise((x,v)=>{var w=u=>{try{i(c.next(u))}catch(d){v(d)}},C=u=>{try{i(c.throw(u))}catch(d){v(d)}},i=u=>u.done?x(u.value):Promise.resolve(u.value).then(w,C);i((c=c.apply(r,U)).next())});import{_ as H,a as W}from"./CrudTable-d5dbb5b5.js";import{u as X,_ as ee,a as le,b as te}from"./useCRUD-bc17d7e5.js";import{_ as ae}from"./QueryBarItem-61168685.js";import{a as oe}from"./TheIcon-eb82caa9.js";import{s as f,q as _,Z as se,o as $,j as z,w as n,n as ne,k as t,m as N,l as e,_ as g,z as re,aP as S,aJ as ie,h as b}from"./index-967a368f.js";import{a as I}from"./icon-8918c9e9.js";import{_ as ue}from"./Checkbox-55f9ae12.js";import{_ as de}from"./Select-589412ca.js";import"./AppPage-2347a5b8.js";import"./_plugin-vue_export-helper-b1890646.js";import"./Space-9d5a9065.js";import"./Tag-2664c78d.js";import"./create-0094aa60.js";import"./use-compitable-f97a7f2f.js";import"./Suffix-5fa70e3c.js";import"./Empty-f250f8a4.js";const y={pageUser:(r={})=>f.post("/user/pageUser",r),listRole:()=>f.post("/role/listRole"),getUser:(r={})=>f.post("/user/getUser",r),updateUser:(r={})=>f.post("/user/updateUser",r),addUser:(r={})=>f.post("/user/addUser",r),deleteUser:(r={})=>f.post("/user/deleteUser",r)},$e={__name:"index",setup(r){const U=o=>!o||/^\d+$/.test(o),c=_([{label:"男",value:1},{label:"女",value:0}]),x=_([{label:"有效",value:1},{label:"无效",value:0}]),v=_(null),w=_([]);se(()=>{v.value.handleSearch(),C()});function C(){return T(this,null,function*(){var l;(l=(yield y.listRole()).data)==null||l.forEach(h=>{const p={label:h.roleName,value:h.id};w.value.push(p)})})}const i=_({});function u(){for(const o in i.value)i.value[o]=null}const d=_([]);function V(o){o.length?d.value=[...o]:d.value=[]}function B(){d.value.length?(O({ids:d.value}),d.value=[]):$message.error("未选中任何数据")}const D=[{type:"selection",fixed:"left"},{title:"用户名称",key:"username",width:120,ellipsis:{tooltip:!0}},{title:"邮箱",key:"email",width:180,ellipsis:{tooltip:!0}},{title:"电话号码",key:"phone",width:120},{title:"头像",key:"mvYear",width:120,ellipsis:{tooltip:!0}},{title:"性别",key:"sex.description",width:80},{title:"创建时间",key:"createTime",width:180,render(o){return b("span",o.createTime)}},{title:"更新时间",key:"updateTime",width:180,render(o){return b("span",o.updateTime)}},{title:"状态",key:"state.description",width:80},{title:"角色",key:"role.roleName",width:80},{title:"操作",key:"actions",width:280,align:"center",fixed:"right",hideInExcel:!0,render(o){return[b(g,{size:"small",type:"primary",secondary:!0,onClick:()=>{j(o,!1)}},{default:()=>"查看",icon:I("majesticons:eye-line",{size:14})}),b(g,{size:"small",type:"primary",style:"margin-left: 15px;",onClick:()=>{K({id:o.id})}},{default:()=>"编辑",icon:I("material-symbols:edit-outline",{size:14})}),b(g,{size:"small",type:"error",style:"margin-left: 15px;",onClick:()=>{O({ids:[o.id]})}},{default:()=>"删除",icon:I("material-symbols:delete-outline",{size:14})})]}}],{modalVisible:q,modalAction:k,modalTitle:F,modalLoading:A,handleAdd:E,handleSave:Q,handleView:j,handleEdit:K,handleDelete:O,modalForm:s,modalFormRef:P}=X({name:"用户",initForm:{state:{},sex:{},role:{}},doCreate:y.addUser,doDelete:y.deleteUser,doUpdate:y.updateUser,doSearch:y.getUser,refresh:()=>{var o;return(o=v.value)==null?void 0:o.handleSearch()}});return(o,l)=>{const h=oe,p=ue,J=ae,L=W,m=ee,R=de,M=le,Y=te,Z=H;return $(),z(Z,{"show-footer":"",title:"用户管理"},{action:n(()=>[ne("div",null,[t(e(g),{type:"primary",onClick:e(E)},{default:n(()=>[t(h,{icon:"material-symbols:add",size:18,class:"mr-5"}),N(" 新建用户 ")]),_:1},8,["onClick"]),t(e(g),{type:"error",class:"ml-16",onClick:B},{default:n(()=>[t(h,{icon:"material-symbols:delete-outline",size:18,class:"mr-5"}),N(" 批量删除 ")]),_:1})])]),default:n(()=>[t(L,{ref_key:"$table",ref:v,"query-items":i.value,"onUpdate:queryItems":l[1]||(l[1]=a=>i.value=a),"row-key":"id","scroll-x":1200,columns:D,"get-data":e(y).pageUser,onOnChecked:V,onResetQueryItems:u},{queryBar:n(()=>[t(J,{label:"用户名/邮箱/号码","label-width":120},{default:n(()=>{var a;return[t(p,{value:i.value.condition,"onUpdate:value":l[0]||(l[0]=G=>i.value.condition=G),type:"text",placeholder:"请用户名",onKeypress:re((a=v.value)==null?void 0:a.handleSearch,["enter"])},null,8,["value","onKeypress"])]}),_:1})]),_:1},8,["query-items","get-data"]),t(Y,{visible:e(q),"onUpdate:visible":l[11]||(l[11]=a=>ie(q)?q.value=a:null),title:e(F),loading:e(A),"show-footer":e(k)!=="view",onOnSave:e(Q)},{default:n(()=>[t(M,{ref_key:"modalFormRef",ref:P,model:e(s),"label-placement":"left","label-align":"left","label-width":80,disabled:e(k)==="view"},{default:n(()=>[t(m,{label:"用户id",path:"id"},{default:n(()=>[t(p,{value:e(s).id,"onUpdate:value":l[2]||(l[2]=a=>e(s).id=a),disabled:""},null,8,["value"])]),_:1}),t(m,{label:"用户名称",path:"username",rule:{required:!0,message:"请输入用户名称",trigger:"blur"}},{default:n(()=>[t(p,{value:e(s).username,"onUpdate:value":l[3]||(l[3]=a=>e(s).username=a),placeholder:"请输入用户名称"},null,8,["value"])]),_:1}),e(k)!=="view"?($(),z(m,{key:0,label:"用户密码",path:"password",rule:{required:!0,message:"请输入用户密码",trigger:"blur"}},{default:n(()=>[t(p,{value:e(s).password,"onUpdate:value":l[4]||(l[4]=a=>e(s).password=a),type:"password","show-password-on":"click",placeholder:"请输入用户密码"},null,8,["value"])]),_:1})):S("",!0),t(m,{label:"邮箱",path:"email"},{default:n(()=>[t(p,{value:e(s).email,"onUpdate:value":l[5]||(l[5]=a=>e(s).email=a),placeholder:"请输入用户邮箱"},null,8,["value"])]),_:1}),t(m,{label:"电话号码",path:"phone"},{default:n(()=>[t(p,{value:e(s).phone,"onUpdate:value":l[6]||(l[6]=a=>e(s).phone=a),maxlength:"11","show-count":"","allow-input":U,placeholder:"请输入电话号码"},null,8,["value"])]),_:1}),t(m,{label:"头像",path:"avatar"},{default:n(()=>[t(p,{value:e(s).avatar,"onUpdate:value":l[7]||(l[7]=a=>e(s).avatar=a),placeholder:"请上传头像"},null,8,["value"])]),_:1}),t(m,{label:"性别",path:"sex.value",rule:{required:!0,message:"请选择性别",trigger:"change",type:"number"}},{default:n(()=>[t(R,{value:e(s).sex.value,"onUpdate:value":l[8]||(l[8]=a=>e(s).sex.value=a),placeholder:"请选择",options:c.value},null,8,["value","options"])]),_:1}),e(k)!=="add"?($(),z(m,{key:1,label:"状态",path:"state.value",rule:{required:!0,message:"请选择状态",trigger:"change",type:"number"}},{default:n(()=>[t(R,{value:e(s).state.value,"onUpdate:value":l[9]||(l[9]=a=>e(s).state.value=a),placeholder:"请选择",options:x.value},null,8,["value","options"])]),_:1})):S("",!0),t(m,{label:"角色",path:"role.id",rule:{required:!0,message:"请选择角色",trigger:"change",type:"number"}},{default:n(()=>[t(R,{value:e(s).role.id,"onUpdate:value":l[10]||(l[10]=a=>e(s).role.id=a),placeholder:"请选择",options:w.value},null,8,["value","options"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["visible","title","loading","show-footer","onOnSave"])]),_:1})}}};export{$e as default};
