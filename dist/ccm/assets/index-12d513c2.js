var z=(a,i,l)=>new Promise((v,c)=>{var w=r=>{try{_(l.next(r))}catch(f){c(f)}},x=r=>{try{_(l.throw(r))}catch(f){c(f)}},_=r=>r.done?v(r.value):Promise.resolve(r.value).then(w,x);_((l=l.apply(a,i)).next())});import{_ as M}from"./AppPage-7316f500.js";import{_ as O}from"./CrudDrawer-cc93fcce.js";import{s as C,G as Q,H as W,C as X,q as D,h,_ as m,J as Y,o as U,j as R,w as n,k as s,K as V,l as e,m as S,D as q,L as Z}from"./index-fcd7eebc.js";import{u as ee,_ as te,a as oe}from"./useCRUD-c139838b.js";import{r as b}from"./icon-7bfbf4ba.js";import{_ as ae}from"./Spin-0a4b3590.js";import{_ as ne}from"./Tree-f1162475.js";import{_ as re}from"./Space-7ee4e193.js";import{_ as se}from"./Input-cea9b87e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./use-merged-state-3264fb8d.js";import"./get-eaa4dfe4.js";import"./use-compitable-3d6c947e.js";import"./Checkbox-933958cf.js";import"./create-d1a5db2f.js";import"./Empty-0b13ab0a.js";import"./use-locale-ea43045e.js";import"./Suffix-8eaa0c4a.js";import"./Eye-1bd242ac.js";const k={listUserCategory:()=>C.post("/category/listUserCategory"),addCategory:(a={})=>C.post("/category/addCategory",a),updateCategory:(a={})=>C.post("/category/updateCategory",a),moveCategory:(a={})=>C.post("/category/moveCategory",a),deleteCategory:(a={})=>C.post("/category/deleteCategory",a)};function $(a){const i=Q(),{accessPermissions:l}=W(i);return!!l.value.includes(a)}const Ue={__name:"index",setup(a){X(()=>{c()});const i=D([]),l=D([]),v=D(!1);function c(){return z(this,null,function*(){v.value=!0;const y=yield k.listUserCategory(),t=w(y.data);l.value=t,v.value=!1})}function w(y=[]){const t=[];return y.forEach(o=>{const u=[];$("updateCategory")&&u.push(h(m,{size:"small",type:"primary",text:!0,style:"margin-left: 15px;",onClick:()=>{H({parent:o.id,name:o.name},!1)}},{default:()=>"",icon:b("material-symbols:edit-outline",{size:20})}),h(m,{size:"small",type:"primary",text:!0,style:"margin-left: 15px;",onClick:()=>{_({id:o.id,up:!0})}},{default:()=>"",icon:b("material-symbols:arrow-upward",{size:20})}),h(m,{size:"small",type:"primary",text:!0,onClick:()=>{_({id:o.id,up:!1})}},{default:()=>"",icon:b("material-symbols:arrow-downward",{size:20})})),$("deleteCategory")&&u.unshift(h(m,{size:"small",type:"error",text:!0,style:"margin-left: 15px;",onClick:()=>{P({ids:[o.id]})}},{default:()=>"",icon:b("material-symbols:delete-outline",{size:20})}));const g={label:o.name,key:o.id,children:[]};o.level===0?($("addCategory")&&u.unshift(h(m,{size:"small",type:"primary",text:!0,onClick:()=>{F({parent:o.id})}},{default:()=>"",icon:b("material-symbols:add-notes-outline-rounded",{size:22})})),g.suffix=()=>u):g.suffix=()=>u,o.children&&o.children.length&&(g.children=w(o.children)),t.push(g)}),t}function x(){p.value.id=p.value.parent,L()}function _(){return z(this,arguments,function*(y={}){yield k.moveCategory(y),c()})}const{modalVisible:r,modalAction:f,modalTitle:B,modalLoading:E,handleAdd:F,handleDelete:P,handleEdit:H,handleSave:L,modalForm:p,modalFormRef:N}=ee({name:"分类",initForm:{},doCreate:k.addCategory,doDelete:k.deleteCategory,doUpdate:k.updateCategory,refresh:()=>c()});return(y,t)=>{const o=ne,u=ae,g=re,A=se,K=te,j=oe,G=O,I=Z,J=M,T=Y("permission");return U(),R(J,{"show-footer":!1},{default:n(()=>[s(I,{title:"分类管理",size:"small",segmented:!0,"mt-15":"","rounded-10":""},{"header-extra":n(()=>[V((U(),R(e(m),{type:"primary",onClick:e(F)},{default:n(()=>[S(" 新增主分类 ")]),_:1},8,["onClick"])),[[T,"addCategory"]]),V((U(),R(e(m),{type:"error","ml-20":"",onClick:t[0]||(t[0]=d=>e(P)({ids:e(i)}))},{default:n(()=>[S(" 删除 ")]),_:1})),[[T,"deleteCategory"]])]),default:n(()=>[s(g,{vertical:""},{default:n(()=>[s(u,{show:e(v)},{description:n(()=>[S("加载中 ~")]),default:n(()=>[s(o,{"checked-keys":e(i),"onUpdate:checkedKeys":t[1]||(t[1]=d=>q(i)?i.value=d:null),data:e(l),checkable:"",selectable:"","block-line":"",cascade:""},null,8,["checked-keys","data"])]),_:1},8,["show"])]),_:1}),s(G,{visible:e(r),"onUpdate:visible":t[4]||(t[4]=d=>q(r)?r.value=d:null),title:e(B),loading:e(E),"show-footer":e(f)!=="view",onOnSave:x},{default:n(()=>[s(j,{ref_key:"modalFormRef",ref:N,model:e(p),"label-placement":"left","label-align":"left","label-width":80,disabled:e(f)==="view"},{default:n(()=>[s(K,{label:"父分类id",path:"parent"},{default:n(()=>[s(A,{value:e(p).parent,"onUpdate:value":t[2]||(t[2]=d=>e(p).parent=d),disabled:""},null,8,["value"])]),_:1}),s(K,{label:"分类名称"},{default:n(()=>[s(A,{value:e(p).name,"onUpdate:value":t[3]||(t[3]=d=>e(p).name=d),placeholder:"请输入分类名称"},null,8,["value"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["visible","title","loading","show-footer"])]),_:1})]),_:1})}}};export{Ue as default};
