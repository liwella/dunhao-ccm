var T=(n,U,c)=>new Promise((x,v)=>{var w=u=>{try{i(c.next(u))}catch(d){v(d)}},C=u=>{try{i(c.throw(u))}catch(d){v(d)}},i=u=>u.done?x(u.value):Promise.resolve(u.value).then(w,C);i((c=c.apply(n,U)).next())});import{_ as W}from"./CommonPage-06556ed1.js";import{_ as X}from"./CrudDrawer-cc93fcce.js";import{_ as Z}from"./CrudTable-aa655061.js";import{_ as ee}from"./QueryBarItem-5bc565a3.js";import{_ as te}from"./TheIcon-e8a5b0d0.js";import{s as f,q as _,C as le,o as z,j as $,w as s,n as ae,k as l,l as e,_ as g,m as N,z as oe,D as re,F as S,h as b}from"./index-fcd7eebc.js";import{r as I}from"./icon-7bfbf4ba.js";import{u as se,_ as ne,a as ie}from"./useCRUD-c139838b.js";import{_ as ue}from"./Input-cea9b87e.js";import{_ as de}from"./Select-40890403.js";import"./AppPage-7316f500.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./use-merged-state-3264fb8d.js";import"./Space-7ee4e193.js";import"./Checkbox-933958cf.js";import"./Popover-f5e6c032.js";import"./get-eaa4dfe4.js";import"./use-compitable-3d6c947e.js";import"./Suffix-8eaa0c4a.js";import"./Dropdown-ca79176c.js";import"./create-d1a5db2f.js";import"./Tooltip-1bd68290.js";import"./Empty-0b13ab0a.js";import"./use-locale-ea43045e.js";import"./Eye-1bd242ac.js";import"./Tag-51d84e9a.js";const y={pageUser:(n={})=>f.post("/user/pageUser",n),listRole:()=>f.post("/role/listRole"),getUser:(n={})=>f.post("/user/getUser",n),updateUser:(n={})=>f.post("/user/updateUser",n),addUser:(n={})=>f.post("/user/addUser",n),deleteUser:(n={})=>f.post("/user/deleteUser",n)},Fe={__name:"index",setup(n){const U=o=>!o||/^\d+$/.test(o),c=_([{label:"男",value:1},{label:"女",value:0}]),x=_([{label:"有效",value:1},{label:"无效",value:0}]),v=_(null),w=_([]);le(()=>{v.value.handleSearch(),C()});function C(){return T(this,null,function*(){var t;(t=(yield y.listRole()).data)==null||t.forEach(h=>{const p={label:h.roleName,value:h.id};w.value.push(p)})})}const i=_({});function u(){for(const o in i.value)i.value[o]=null}const d=_([]);function D(o){o.length?d.value=[...o]:d.value=[]}function V(){d.value.length?(O({ids:d.value}),d.value=[]):$message.error("未选中任何数据")}const B=[{type:"selection",fixed:"left"},{title:"用户名称",key:"username",width:120,ellipsis:{tooltip:!0}},{title:"邮箱",key:"email",width:180,ellipsis:{tooltip:!0}},{title:"电话号码",key:"phone",width:120},{title:"头像",key:"mvYear",width:120,ellipsis:{tooltip:!0}},{title:"性别",key:"sex.description",width:80},{title:"创建时间",key:"createTime",width:180,render(o){return b("span",o.createTime)}},{title:"更新时间",key:"updateTime",width:180,render(o){return b("span",o.updateTime)}},{title:"状态",key:"state.description",width:80},{title:"角色",key:"role.roleName",width:80},{title:"操作",key:"actions",width:280,align:"center",fixed:"right",hideInExcel:!0,render(o){return[b(g,{size:"small",type:"primary",secondary:!0,onClick:()=>{j(o,!1)}},{default:()=>"查看",icon:I("majesticons:eye-line",{size:14})}),b(g,{size:"small",type:"primary",style:"margin-left: 15px;",onClick:()=>{K({id:o.id})}},{default:()=>"编辑",icon:I("material-symbols:edit-outline",{size:14})}),b(g,{size:"small",type:"error",style:"margin-left: 15px;",onClick:()=>{O({ids:[o.id]})}},{default:()=>"删除",icon:I("material-symbols:delete-outline",{size:14})})]}}],{modalVisible:q,modalAction:k,modalTitle:F,modalLoading:A,handleAdd:E,handleSave:Q,handleView:j,handleEdit:K,handleDelete:O,modalForm:r,modalFormRef:L}=se({name:"用户",initForm:{state:{},sex:{},role:{}},doCreate:y.addUser,doDelete:y.deleteUser,doUpdate:y.updateUser,doSearch:y.getUser,refresh:()=>{var o;return(o=v.value)==null?void 0:o.handleSearch()}});return(o,t)=>{const h=te,p=ue,M=ee,P=Z,m=ne,R=de,Y=ie,G=X,H=W;return z(),$(H,{"show-footer":"",title:"用户管理"},{action:s(()=>[ae("div",null,[l(e(g),{type:"primary",onClick:e(E)},{default:s(()=>[l(h,{icon:"material-symbols:add",size:18,class:"mr-5"}),N(" 新建用户 ")]),_:1},8,["onClick"]),l(e(g),{type:"error",class:"ml-16",onClick:V},{default:s(()=>[l(h,{icon:"material-symbols:delete-outline",size:18,class:"mr-5"}),N(" 批量删除 ")]),_:1})])]),default:s(()=>[l(P,{ref_key:"$table",ref:v,"query-items":i.value,"onUpdate:queryItems":t[1]||(t[1]=a=>i.value=a),"row-key":"id","scroll-x":1200,columns:B,"get-data":e(y).pageUser,onOnChecked:D,onResetQueryItems:u},{queryBar:s(()=>[l(M,{label:"用户名/邮箱/号码","label-width":120},{default:s(()=>{var a;return[l(p,{value:i.value.condition,"onUpdate:value":t[0]||(t[0]=J=>i.value.condition=J),type:"text",placeholder:"请用户名",onKeypress:oe((a=v.value)==null?void 0:a.handleSearch,["enter"])},null,8,["value","onKeypress"])]}),_:1})]),_:1},8,["query-items","get-data"]),l(G,{visible:e(q),"onUpdate:visible":t[11]||(t[11]=a=>re(q)?q.value=a:null),title:e(F),loading:e(A),"show-footer":e(k)!=="view",onOnSave:e(Q)},{default:s(()=>[l(Y,{ref_key:"modalFormRef",ref:L,model:e(r),"label-placement":"left","label-align":"left","label-width":80,disabled:e(k)==="view"},{default:s(()=>[l(m,{label:"用户id",path:"id"},{default:s(()=>[l(p,{value:e(r).id,"onUpdate:value":t[2]||(t[2]=a=>e(r).id=a),disabled:""},null,8,["value"])]),_:1}),l(m,{label:"用户名称",path:"username",rule:{required:!0,message:"请输入用户名称",trigger:"blur"}},{default:s(()=>[l(p,{value:e(r).username,"onUpdate:value":t[3]||(t[3]=a=>e(r).username=a),placeholder:"请输入用户名称"},null,8,["value"])]),_:1}),e(k)!=="view"?(z(),$(m,{key:0,label:"用户密码",path:"password",rule:{required:!0,message:"请输入用户密码",trigger:"blur"}},{default:s(()=>[l(p,{value:e(r).password,"onUpdate:value":t[4]||(t[4]=a=>e(r).password=a),type:"password","show-password-on":"click",placeholder:"请输入用户密码"},null,8,["value"])]),_:1})):S("",!0),l(m,{label:"邮箱",path:"email"},{default:s(()=>[l(p,{value:e(r).email,"onUpdate:value":t[5]||(t[5]=a=>e(r).email=a),placeholder:"请输入用户邮箱"},null,8,["value"])]),_:1}),l(m,{label:"电话号码",path:"phone"},{default:s(()=>[l(p,{value:e(r).phone,"onUpdate:value":t[6]||(t[6]=a=>e(r).phone=a),maxlength:"11","show-count":"","allow-input":U,placeholder:"请输入电话号码"},null,8,["value"])]),_:1}),l(m,{label:"头像",path:"avatar"},{default:s(()=>[l(p,{value:e(r).avatar,"onUpdate:value":t[7]||(t[7]=a=>e(r).avatar=a),placeholder:"请上传头像"},null,8,["value"])]),_:1}),l(m,{label:"性别",path:"sex.value",rule:{required:!0,message:"请选择性别",trigger:"change",type:"number"}},{default:s(()=>[l(R,{value:e(r).sex.value,"onUpdate:value":t[8]||(t[8]=a=>e(r).sex.value=a),placeholder:"请选择",options:c.value},null,8,["value","options"])]),_:1}),e(k)!=="add"?(z(),$(m,{key:1,label:"状态",path:"state.value",rule:{required:!0,message:"请选择状态",trigger:"change",type:"number"}},{default:s(()=>[l(R,{value:e(r).state.value,"onUpdate:value":t[9]||(t[9]=a=>e(r).state.value=a),placeholder:"请选择",options:x.value},null,8,["value","options"])]),_:1})):S("",!0),l(m,{label:"角色",path:"role.id",rule:{required:!0,message:"请选择角色",trigger:"change",type:"number"}},{default:s(()=>[l(R,{value:e(r).role.id,"onUpdate:value":t[10]||(t[10]=a=>e(r).role.id=a),placeholder:"请选择",options:w.value},null,8,["value","options"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["visible","title","loading","show-footer","onOnSave"])]),_:1})}}};export{Fe as default};
