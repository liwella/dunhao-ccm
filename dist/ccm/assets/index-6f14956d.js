var w=(n,p,u)=>new Promise((k,R)=>{var M=r=>{try{h(u.next(r))}catch(d){R(d)}},m=r=>{try{h(u.throw(r))}catch(d){R(d)}},h=r=>r.done?k(r.value):Promise.resolve(r.value).then(M,m);h((u=u.apply(n,p)).next())});import{_ as ae}from"./CommonPage-5693a2f8.js";import{_ as ne}from"./CrudDrawer-343eb8ff.js";import{_ as ie}from"./CrudTable-1a5213e2.js";import{_ as se}from"./TheIcon-ef78c118.js";import{s as _,q as v,C as re,o as A,j as B,w as s,n as P,k as o,l as t,_ as b,m as O,D as x,F as de,h as N}from"./index-a05ebb11.js";import{u as L,_ as ue,a as me}from"./useCRUD-3b029c3f.js";import{r as z}from"./icon-ff0c09b3.js";import{_ as ce}from"./Tree-62a1861c.js";import{_ as pe}from"./Input-aa8ec768.js";import"./AppPage-d038b9ad.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./use-merged-state-ff5e0511.js";import"./Space-5f0be7ca.js";import"./Checkbox-c0ec2f7e.js";import"./Popover-89938a61.js";import"./get-f8141a7b.js";import"./use-compitable-cbdc2722.js";import"./Suffix-b467bef6.js";import"./Dropdown-40c84ca6.js";import"./create-d1a5db2f.js";import"./Tooltip-1768249a.js";import"./Empty-12035f64.js";import"./use-locale-cb2f3061.js";import"./Select-924e31d5.js";import"./Tag-5efc3a3f.js";import"./Eye-c02532aa.js";const c={listRole:()=>_.post("/role/listRole"),addRole:(n={})=>_.post("/role/addRole",n),updateRole:(n={})=>_.post("/role/updateRole",n),deleteRole:(n={})=>_.post("/role/deleteRole",n),listMenu:()=>_.post("/menu/listMenu"),listRoleMenu:(n={})=>_.post("/roleMenu/listRoleMenu",n),updateRoleMenu:(n={})=>_.post("/roleMenu/updateRoleMenu",n)},fe=P("div",null,null,-1),Le={__name:"index",setup(n){const p=v(null);re(()=>{p.value.handleSearch(),R()});const u=v([]),k=v(!1);function R(){return w(this,null,function*(){k.value=!0,u.value=[];const l=yield c.listMenu(),e=M(l.data);u.value=e,k.value=!1})}function M(l=[]){const e=[];return l.forEach(i=>{const C={label:i.menuName+" / "+i.permission,key:i.id,children:[]};i.children&&i.children.length&&(C.children=M(i.children)),e.push(C)}),e}const m=v([]);function h(l){return w(this,null,function*(){m.value=[];const e=yield c.listRoleMenu({id:l});e==null||e.data.forEach(i=>{m.value.push(i.menuId)})})}function r(){return w(this,null,function*(){var l;if(E.value.menuIds=m.value,!["edit","add"].includes(V.value)){g.value=!1;return}try{S.value=!0;const e=yield c.updateRoleMenu(E.value);$message.success("编辑成功"),S.value=g.value=!1,e&&((l=p.value)==null||l.handleSearch())}catch(e){F.value=!1}})}const d=v({});function Q(){for(const l in d.value)d.value[l]=null}const y=v([]);function j(l){l.length?y.value=[...l]:y.value=[]}function H(){y.value.length?($({ids:y.value}),y.value=[]):$message.error("未选中任何数据")}const K=[{type:"selection",fixed:"left"},{title:"角色名称",key:"roleName",width:240},{title:"角色编码",key:"code",width:240},{title:"操作",key:"actions",width:200,align:"center",fixed:"right",hideInExcel:!0,render(l){return[N(b,{size:"small",type:"primary",onClick:()=>{W(l,!1)}},{default:()=>"编辑",icon:z("material-symbols:edit-outline",{size:14})}),N(b,{size:"small",type:"primary",style:"margin-left: 15px;",onClick:()=>{h(l.id),ee({roleId:l.id},!1)}},{default:()=>"编辑权限",icon:z("ic:baseline-vpn-key",{size:14})}),N(b,{size:"small",type:"error",style:"margin-left: 15px;",onClick:()=>{$({ids:[l.id]})}},{default:()=>"删除",icon:z("material-symbols:delete-outline",{size:14})})]}}],{modalVisible:D,modalTitle:G,modalLoading:F,modalAction:I,handleAdd:J,handleDelete:$,handleEdit:W,handleSave:X,modalForm:f,modalFormRef:Y}=L({name:"角色",initForm:{},doCreate:c.addRole,doDelete:c.deleteRole,doUpdate:c.updateRole,doSearch:null,refresh:()=>{var l;return(l=p.value)==null?void 0:l.handleSearch()}}),{modalVisible:g,modalTitle:Z,modalLoading:S,modalAction:V,handleEdit:ee,modalForm:E}=L({name:"角色权限",initForm:{},doCreate:null,doDelete:null,doUpdate:c.updateRoleMenu,doSearch:null,refresh:()=>{var l;return(l=p.value)==null?void 0:l.handleSearch()}});return(l,e)=>{const i=se,C=ie,U=pe,q=ue,le=me,T=ne,te=ce,oe=ae;return A(),B(oe,{"show-footer":"",title:"角色管理"},{action:s(()=>[P("div",null,[o(t(b),{type:"primary",onClick:t(J)},{default:s(()=>[o(i,{icon:"material-symbols:add",size:18,class:"mr-5"}),O(" 新建角色 ")]),_:1},8,["onClick"]),o(t(b),{type:"error",class:"ml-16",onClick:H},{default:s(()=>[o(i,{icon:"material-symbols:delete-outline",size:18,class:"mr-5"}),O(" 批量删除 ")]),_:1})])]),default:s(()=>[o(C,{ref_key:"$table",ref:p,"query-items":t(d),"onUpdate:queryItems":e[0]||(e[0]=a=>x(d)?d.value=a:null),"row-key":"id","scroll-x":1200,columns:K,"is-pagination":!1,"get-data":t(c).listRole,onOnChecked:j,onResetQueryItems:Q},{queryBar:s(()=>[fe]),_:1},8,["query-items","get-data"]),o(T,{visible:t(D),"onUpdate:visible":e[4]||(e[4]=a=>x(D)?D.value=a:null),title:t(G),loading:t(F),"show-footer":t(I)!=="view",onOnSave:t(X)},{default:s(()=>[o(le,{ref_key:"modalFormRef",ref:Y,model:t(f),"label-placement":"left","label-align":"left","label-width":80,disabled:t(I)==="view"},{default:s(()=>[o(q,{labe:"角色id",path:"id"},{default:s(()=>[o(U,{value:t(f).id,"onUpdate:value":e[1]||(e[1]=a=>t(f).id=a),disabled:""},null,8,["value"])]),_:1}),o(q,{label:"角色名称",path:"roleName",rule:{required:!0,message:"请输入角色名称",trigger:"blur"}},{default:s(()=>[o(U,{value:t(f).roleName,"onUpdate:value":e[2]||(e[2]=a=>t(f).roleName=a),maxlength:"15",placeholder:"请输入角色名称"},null,8,["value"])]),_:1}),t(I)==="add"?(A(),B(q,{key:0,label:"角色编码",path:"code",rule:{required:!0,message:"请输入角色编码",trigger:"blur"}},{default:s(()=>[o(U,{value:t(f).code,"onUpdate:value":e[3]||(e[3]=a=>t(f).code=a),maxlength:"10",placeholder:"请输入角色编码"},null,8,["value"])]),_:1})):de("",!0)]),_:1},8,["model","disabled"])]),_:1},8,["visible","title","loading","show-footer","onOnSave"]),o(T,{visible:t(g),"onUpdate:visible":e[6]||(e[6]=a=>x(g)?g.value=a:null),title:t(Z),loading:t(S),"show-footer":t(V)!=="view",onOnSave:r},{default:s(()=>[o(te,{"checked-keys":t(m),"onUpdate:checkedKeys":e[5]||(e[5]=a=>x(m)?m.value=a:null),data:t(u),checkable:"",selectable:"","block-line":"","default-expand-all":""},null,8,["checked-keys","data"])]),_:1},8,["visible","title","loading","show-footer"])]),_:1})}}};export{Le as default};
