var f=(o,v,c)=>new Promise((h,u)=>{var I=t=>{try{s(c.next(t))}catch(g){u(g)}},r=t=>{try{s(c.throw(t))}catch(g){u(g)}},s=t=>t.done?h(t.value):Promise.resolve(t.value).then(I,r);s((c=c.apply(o,v)).next())});import{_ as N}from"./AppPage-a99f4111.js";import{s as p,Z as E,q as y,o as w,j as U,w as i,k as m,aB as b,ah as T,aC as V,aP as $,n as j,c2 as M,b3 as q}from"./index-e20992e7.js";import{_ as z}from"./Select-e1f2d685.js";import{_ as P}from"./Spin-13726563.js";import{_ as A}from"./Space-6b46028d.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./use-merged-state-6f165b97.js";import"./create-f3bd0fbc.js";import"./Suffix-e3f3f9a6.js";import"./use-compitable-31c4a204.js";import"./Tag-363a9f4f.js";import"./Empty-fbbb158f.js";const d={listCategory:()=>p.post("/category/listCategory"),listSourceCategory:(o={})=>p.post("/source/listSourceCategory",o),listCategoryMapping:(o={})=>p.post("/categoryMapping/listCategoryMapping",o),listSimpleSc:()=>p.post("/sourceConfig/listSimpleSc"),addOrUpdate:(o={})=>p.post("/categoryMapping/addOrUpdate",o),deleteMapping:(o={})=>p.post("/categoryMapping/delete",o)},F={key:0,flex:"","flex-wrap":"","justify-between":""},R=j("div",{"h-10":"","w-300":""},null,-1),oe={__name:"index",setup(o){E(()=>{I(),c()});const v=y([]);function c(){return f(this,null,function*(){const e=yield d.listCategory();h(e==null?void 0:e.data)})}function h(e=[]){e.forEach(a=>{const n={label:a.name,value:a.id};v.value.push(n),a.children&&a.children.length&&h(a.children)})}const u=y([]);function I(){return f(this,null,function*(){const e=yield d.listSimpleSc();e==null||e.data.forEach(a=>{const n={label:a.sourceName,value:a.id};u.value.push(n)})})}const r=y(null),s=y(!1),t=y([]);function g(e){return f(this,null,function*(){if(M(e))return;s.value=!0;const a=yield d.listSourceCategory({id:e}),n=yield d.listCategoryMapping({sourceId:e});n==null||n.data.forEach(_=>{const C=a==null?void 0:a.data.find(S=>S.type_id===_.sourceTypeId);M(C)||(C.categoryId=_.categoryId)}),t.value=a==null?void 0:a.data,s.value=!1})}function k(e){return f(this,null,function*(){if(e.loading=!0,M(e.categoryId)){yield d.deleteMapping({sourceId:r.value,sourceTypeId:e.type_id}),e.loading=!1;return}const a={sourceId:r.value,sourceTypeId:e.type_id,categoryId:e.categoryId};yield d.addOrUpdate(a),e.loading=!1})}return(e,a)=>{const n=z,_=q,C=P,S=A,O=N;return w(),U(O,{"show-footer":!1},{default:i(()=>[m(_,{title:"映射管理",size:"small",segmented:!0,"mt-15":"","rounded-10":""},{"header-extra":i(()=>[m(n,{value:r.value,"onUpdate:value":[a[0]||(a[0]=l=>r.value=l),g],placeholder:"请选择采集源",options:u.value,clearable:"","w-3xl":""},null,8,["value","options"])]),default:i(()=>[m(S,{vertical:""},{default:i(()=>[m(C,{show:s.value},{default:i(()=>[r.value?(w(),b("div",F,[(w(!0),b(T,null,V(t.value,(l,B)=>(w(),U(_,{key:B,class:"mb-10 mr-10 w-200 flex-shrink-0 cursor-pointer","hover:card-shadow":"",title:l.type_name,size:"small"},{default:i(()=>[m(n,{value:l.categoryId,"onUpdate:value":[x=>l.categoryId=x,x=>k(l)],options:v.value,loading:l.loading,filterable:"",clearable:"",placeholder:"请选择分类"},null,8,["value","onUpdate:value","options","loading"])]),_:2},1032,["title"]))),128))])):$("",!0)]),_:1},8,["show"])]),_:1}),R]),_:1})]),_:1})}}};export{oe as default};
